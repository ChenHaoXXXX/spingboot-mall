<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>YY商城</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <style>
        .product-card img {
            height: 180px;
            object-fit: contain;
        }
    </style>
</head>

<body>
<!-- 導覽列 -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container">
        <a class="navbar-brand fw-bold text-success" href="#">YY商城</a>
        <div class="d-flex ms-auto align-items-center gap-3">
            <!-- 搜尋框 -->
            <form class="d-flex bg-light rounded-pill px-3 py-1" onsubmit="event.preventDefault(); loadProducts();">
                <input class="form-control border-0 bg-transparent" type="search" id="searchInput" placeholder="Search Product">
                <button class="btn p-0 text-secondary" type="submit"><i class="bi bi-search"></i></button>
            </form>

            <!-- 帳號 -->
            <a href="login" class="text-dark text-decoration-none d-flex align-items-center gap-1">
                <i class="bi bi-person fs-5"></i>
                <span class="fw-semibold">登入</span>
            </a>

            <!-- 購物車 -->
            <a href="#" class="text-dark text-decoration-none d-flex align-items-center gap-1">
                <i class="bi bi-cart fs-5"></i>
                <span class="fw-semibold">購物車</span>
            </a>
        </div>
    </div>
</nav>
<!-- 橫幅 -->
<div class="bg-light text-center py-5">
    <h2 class="fw-bold">歡迎來到YY商城</h2>

</div>

<!-- 過濾條件 -->
<div class="container my-4">
    <div class="row mb-3">
        <div class="col-md-3">
            <select class="form-select" id="categorySelect" onchange="loadProducts()">
                <option value="">全部類別</option>
                <option value="FOOD">食物</option>
                <option value="TOY">玩具</option>
                <option value="E-BOOK">書</option>
                <!-- 依照 ProductCategory enum 增加 -->
            </select>
        </div>
    </div>


    <h4 class="mb-3">商品</h4>

    <div class="row">
        <div class="col-md-3 mb-4" th:each="product : ${products}">
            <div class="card h-100 product-card">
                <!-- 圖片 -->
                <img th:src="${product.imageUrl}" class="card-img-top" th:alt="${product.productName}">

                <!-- 商品內容 -->
                <div class="card-body">
                    <h5 class="card-title" th:text="${product.productName}">商品名稱</h5>
                    <p class="card-text text-muted" th:text="${product.description}">描述</p>
                    <p class="fw-bold">
                        $<span th:text="${product.price}">0.00</span>
                    </p>
                    <button class="btn btn-outline-success w-100"
                            th:onclick="'addToCart(' + ${product.productId} + ')'">
                       添加至購物車
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 頁腳 -->
<footer class="bg-success text-white py-4 mt-5">
    <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center text-center text-md-start">
        <div class="mb-3 mb-md-0">
            <h5 class="fw-bold">Follow us</h5>
            <a href="#" class="text-white me-3"><i class="bi bi-facebook fs-4"></i></a>
            <a href="#" class="text-white"><i class="bi bi-instagram fs-4"></i></a>
        </div>
        <div class="mb-3 mb-md-0 text-center">
            <h5 class="fw-bold">We accept</h5>
            <div class="d-flex justify-content-center align-items-center flex-wrap gap-2">
                <img src="https://img.icons8.com/color/48/000000/visa.png" alt="Visa" height="32">
                <img src="https://img.icons8.com/color/48/000000/mastercard-logo.png" alt="Mastercard" height="32">

            </div>
        </div>
        <div>
            <h5 class="fw-bold">email</h5>
            <p class="mb-0">test1@com.tw</p>
        </div>
    </div>
</footer>

<script>
    document.addEventListener("DOMContentLoaded", loadProducts);

    function loadProducts() {
        const category = document.getElementById("categorySelect").value;
        const search = document.getElementById("searchInput").value;
        let url = `/api/products?`;

        if (category) url += `category=${category}&`;
        if (search) url += `search=${encodeURIComponent(search)}`;

        fetch(url)
            .then(res => res.json())
            .then(products => {
                const container = document.getElementById("productContainer");
                container.innerHTML = "";

                if (products.length === 0) {
                    container.innerHTML = "<p class='text-muted'>查無商品</p>";
                    return;
                }

                products.forEach(p => {
                    const col = document.createElement("div");
                    col.className = "col-md-3 mb-4";
                    col.innerHTML = `
              <div class="card h-100 product-card">
                <img src="${p.imageUrl}" class="card-img-top" alt="${p.name}">
                <div class="card-body">
                  <h5 class="card-title">${p.name}</h5>
                  <p class="card-text text-muted">${p.description}</p>
                  <p class="fw-bold">$${p.price}</p>
                  <button class="btn btn-outline-success w-100" onclick="addToCart(${p.id})">Add to Cart</button>
                </div>
              </div>
            `;
                    container.appendChild(col);
                });
            })
            .catch(error => {
                console.error("產品載入失敗", error);
                document.getElementById("productContainer").innerHTML =
                    `<p class="text-danger">載入商品時發生錯誤</p>`;
            });
    }

    function addToCart(productId) {
        fetch("/api/cart/add", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ productId })
        })
            .then(res => {
                if (!res.ok) throw new Error("加入購物車失敗");
                alert("已加入購物車！");
            })
            .catch(err => alert(err.message));
    }
</script>
</body>
</html>
